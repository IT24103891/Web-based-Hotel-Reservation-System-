<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* --- CSS: Global Variables & Styling --- */
        :root {
            --color-primary: #0077b6; /* Vibrant Blue */
            --color-success: #2a9d8f; /* Accent Teal/Green */
            --color-danger: #e63946; /* Crimson Red */
            --color-dark: #2b3e50; /* Deep Charcoal */
            --color-light-bg: #f8f9fa; /* Warm off-white */
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--color-light-bg);
            margin: 0;
            color: var(--color-dark);
            line-height: 1.6;
        }
        .container {
            max-width: 1250px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* --- CSS: Top Bar --- */
        .topbar {
            background: var(--color-dark);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
        }
        .topbar h1 { margin: 0; font-size: 1.8em; font-weight: 600; }
        .topbar h1 i { margin-right: 10px; color: var(--color-primary); }

        .action-group {
            display: flex;
            gap: 10px;
        }
        .topbar-btn {
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s, transform 0.1s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
        }
        .topbar-btn i { margin-right: 8px; }

        .logout-btn { background: var(--color-danger); }
        .logout-btn:hover { background: #d62839; transform: translateY(-1px); }
        .primary-btn { background: var(--color-primary); }
        .primary-btn:hover { background: #005f96; transform: translateY(-1px); }

        /* --- COLLAPSIBLE SECTIONS (New Styles) --- */
        details {
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            border-left: 5px solid var(--color-primary);
        }
        details summary {
            cursor: pointer;
            outline: none;
            list-style: none; /* Hide default arrow */
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
            margin-bottom: 10px;
        }
        details summary::-webkit-details-marker {
            display: none;
        }
        details summary h2 {
            display: inline;
            font-size: 1.5em;
            color: var(--color-dark);
            transition: color 0.3s;
        }
        details summary h2 i {
            margin-right: 10px;
            color: var(--color-success);
        }

        /* Custom arrow style */
        details summary:before {
            content: "\f0d7"; /* Font Awesome Chevron Down */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            margin-right: 15px;
            transition: transform 0.3s;
            display: inline-block;
            color: var(--color-primary);
        }
        details[open] summary:before {
            transform: rotate(180deg);
        }
        .data-form-content {
            padding-top: 10px;
        }


        /* --- CSS: Forms & Inputs (General Styles) --- */
        label {
            display: block;
            margin-bottom: 5px;
            margin-top: 10px;
            font-weight: 600;
            color: #495057;
        }
        .required { color: var(--color-danger); }
        input:not([type="hidden"]), textarea, select {
            width: 100%;
            padding: 12px;
            margin-bottom: 5px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        input:focus, textarea:focus, select:focus {
            border-color: var(--color-primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 119, 182, 0.15);
        }

        /* Shared Button Styles */
        .success-btn { background: var(--color-success); color: white; }
        .success-btn:hover { background: #268c7c; }

        button[type="submit"] {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: background 0.3s, transform 0.1s;
            text-transform: uppercase;
            margin-top: 20px;
        }
        button[type="submit"]:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* --- CSS: Data Section & Search --- */
        .dashboard-section {
            padding: 20px 0;
        }
        .section-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .section-header {
            color: var(--color-dark);
            font-size: 1.8em;
            margin: 0;
        }
        .search-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .search-input {
            width: 300px;
            padding: 10px;
            border-radius: 20px;
            background: white;
            border: 1px solid #ced4da;
        }
        .badge {
            background: var(--color-primary);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }

        /* Revenue Table Styles (existing) */
        .revenue-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .revenue-table th, .revenue-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        .revenue-table th {
            background: var(--color-dark);
            color: white;
            font-size: 1.1em;
        }
        .revenue-table tr:hover {
            background: #f0f0f0;
        }
        .revenue-table td:last-child {
            font-weight: 700;
            color: var(--color-success);
        }

        /* --- CSS: Hotel Cards --- (Rest of the CSS remains the same) */
        .hotels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
        }
        .hotel-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .hotel-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }
        .hotel-card h3 {
            color: var(--color-dark);
            margin-top: 0;
            font-size: 1.4em;
            border-bottom: 1px dashed #eee;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }
        .hotel-card p {
            margin: 8px 0;
            font-size: 0.95em;
            display: flex;
            align-items: center;
        }
        .hotel-card p strong {
            margin-right: 5px;
            font-weight: 600;
            color: #495057;
        }
        .hotel-card .info-icon {
            margin-right: 8px;
            color: var(--color-primary);
            min-width: 20px;
            text-align: center;
        }

        /* Card Actions Grid */
        .card-actions {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #f8f9fa;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .manage-btn-container {
            grid-column: 1 / span 2;
        }
        .action-btn {
            padding: 10px 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
            box-sizing: border-box;
            text-align: center;
            transition: background 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            text-decoration: none;
            color: white;
        }
        .action-btn i { margin-right: 8px; }

        .delete-btn { background: var(--color-danger); }
        .delete-btn:hover { background: #d62839; }
        .edit-btn { background: var(--color-primary); }
        .edit-btn:hover { background: #005f96; }
        .manage-btn { background: var(--color-success); }
        .manage-btn:hover { background: #268c7c; }

        /* --- CSS: Slider & Modal Styles --- */
        .image-slider-container {
            position: relative;
            width: 100%;
            height: 200px;
            overflow: hidden;
            margin-bottom: 15px;
            border-radius: 8px;
        }
        .slider-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 0.5s;
        }
        .slider-image.active { opacity: 1; }
        .slider-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            z-index: 10;
            border-radius: 50%;
            font-size: 1.1em;
            line-height: 1;
        }
        .prev-btn { left: 10px; }
        .next-btn { right: 10px; }
        .slider-dots {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            display: flex;
            gap: 5px;
        }
        .dot {
            height: 8px;
            width: 8px;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            display: inline-block;
            transition: background-color 0.3s, transform 0.3s;
        }
        .dot.active {
            background-color: white;
            transform: scale(1.2);
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(43, 62, 80, 0.7);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border: none;
            width: 90%;
            max-width: 650px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-content .close {
            color: #aaa;
            float: right;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        /* --- CSS: Toast Notifications --- */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast {
            background-color: white;
            color: var(--color-dark);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 250px;
            border-left: 5px solid;
            opacity: 0;
            transform: translateX(100%);
            animation: slideIn 0.4s forwards, fadeOut 0.4s 4.6s forwards;
        }

        .toast.success { border-color: var(--color-success); }
        .toast.error { border-color: var(--color-danger); }
        .toast.info { border-color: var(--color-primary); }

        .toast-message {
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        .toast-message i { margin-right: 10px; }

        @keyframes slideIn {
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes fadeOut {
            to { opacity: 0; transform: translateX(100%); }
        }
    </style>
</head>
<body>
<div id="toast-container"></div>

<div class="topbar">
    <h1><i class="fas fa-hotel"></i> Admin Hotel Management</h1>
    <div class="action-group">
        <a href="admin-reservations.html" class="topbar-btn primary-btn"><i class="fas fa-list-ul"></i> View Reservations</a>
        <a href="add-room.html" class="topbar-btn primary-btn"><i class="fas fa-bed"></i> Add Room</a>
        <button onclick="logout()" class="topbar-btn logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
    </div>
</div>

<div class="container">

    <details open>
        <summary>
            <h2><i class="fas fa-chart-line"></i> Hotel Revenue Overview</h2>
        </summary>
        <div id="revenueContainer">
            <p class="initial-message">Loading revenue data...</p>
        </div>
    </details>
    <details>
        <summary>
            <h2><i class="fas fa-plus-circle"></i> Add New Hotel</h2>
        </summary>
        <div class="data-form-content">
            <form id="hotelForm">
                <label for="hotelName">Hotel Name <span class="required">*</span></label>
                <input id="hotelName" placeholder="e.g., Grand Hyatt Tokyo" required>

                <label for="hotelLocation">Location <span class="required">*</span></label>
                <input id="hotelLocation" placeholder="e.g., Shibuya, Tokyo" required>

                <label for="hotelDescription">Description (Optional)</label>
                <input id="hotelDescription" placeholder="A brief description of the hotel">

                <label for="hotelImages">Hotel Image URLs (one per line)</label>
                <textarea id="hotelImages" placeholder="Paste image URLs here" rows="4"></textarea>

                <button type="submit" id="submitHotelBtn" class="success-btn">Add Hotel</button>
            </form>
        </div>
    </details>
    <div class="dashboard-section">
        <div class="section-header-row">
            <h2 class="section-header">üè¢ All Hotels</h2>
            <div class="search-controls">
                <input type="text" id="hotelSearch" placeholder="Search by name or location..." class="search-input">
                <span id="hotelCount" class="badge">0 Hotels</span>
            </div>
        </div>

        <div id="hotelsContainer" class="hotels-grid">
            <p class="initial-message">Loading hotels...</p>
        </div>
    </div>
</div>

<div id="editModal" class="modal">
    <div class="modal-content">
        <span onclick="closeModal()" class="close">&times;</span>
        <h2 id="modalTitle">Edit Item</h2>
        <form id="editForm">
            <input type="hidden" id="editItemId">
            <input type="hidden" id="editItemType">

            <label for="editName" id="nameLabel">Name / Number <span class="required">*</span></label>
            <input id="editName" required>

            <label for="editLocation" id="locationLabel">Location <span class="required">*</span></label>
            <input id="editLocation">

            <label for="editDescription" id="descriptionLabel">Description / Type</label>
            <textarea id="editDescription" rows="3"></textarea>

            <div id="roomSpecificFields" style="display:none;">
                <label for="editPrice">Price ($) <span class="required">*</span></label>
                <input id="editPrice" type="number" step="0.01">

                <label for="editAvailable">Available?</label>
                <select id="editAvailable">
                    <option value="true">Available</option>
                    <option value="false">Not Available</option>
                </select>
            </div>

            <label for="editImages">Image URLs (one per line)</label>
            <textarea id="editImages" rows="6" placeholder="Enter image URLs here"></textarea>

            <button type="submit" class="primary-btn" style="margin-top: 15px;">Save Changes</button>
        </form>
    </div>
</div>

<script>
    // --- JavaScript: Logic and Functions ---
    let allHotels = [];
    const API_URL = "http://localhost:8080/api";

    // --- Utility Functions ---
    function logout() { localStorage.clear(); window.location.href = "/login.html"; }

    function urlsToImages(urlText) {
        return urlText.split(/[\n,]/)
            .map(url => url.trim())
            .filter(url => url.length > 0)
            .map((url, index) => ({ imageUrl: url, displayOrder: index }));
    }

    function formatCurrency(amount) {
        const numberAmount = Number(amount);
        if (isNaN(numberAmount)) return '$0.00';
        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(numberAmount);
    }

    function findItem(id, type) {
        if (type === 'hotel') {
            return allHotels.find(h => h.id === id);
        }
        for (const hotel of allHotels) {
            const room = (hotel.rooms || []).find(r => r.id === id);
            if (room) return room;
        }
        return null;
    }

    // --- UX Functions: Toast Notifications (Existing) ---
    function showToast(message, type = 'info') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;

        let icon = '';
        if (type === 'success') icon = '<i class="fas fa-check-circle"></i>';
        if (type === 'error') icon = '<i class="fas fa-exclamation-triangle"></i>';
        if (type === 'info') icon = '<i class="fas fa-info-circle"></i>';

        toast.innerHTML = `<div class="toast-message">${icon} ${message}</div>`;

        container.prepend(toast);

        setTimeout(() => {
            toast.remove();
        }, 5000);
    }
    window.showToast = showToast;


    // --- UX Functions: Loading States (Existing) ---
    function setLoading(buttonId, isLoading) {
        const button = document.getElementById(buttonId);
        let submitBtn = button;
        if (!button) {
            const form = document.getElementById('editForm');
            submitBtn = form ? form.querySelector('button[type="submit"]') : null;
        }

        if (!submitBtn) return;

        if (isLoading) {
            submitBtn.dataset.originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            submitBtn.disabled = true;
        } else {
            submitBtn.innerHTML = submitBtn.dataset.originalText || 'Save Changes';
            submitBtn.disabled = false;
        }
    }


    // --- API & CRUD Functions ---

    async function loadHotels() {
        const container = document.getElementById("hotelsContainer");
        const countBadge = document.getElementById("hotelCount");
        container.innerHTML = '<p class="initial-message"><i class="fas fa-sync-alt fa-spin"></i> Loading hotel data...</p>';

        try {
            const res = await fetch(`${API_URL}/hotels`);
            if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);

            allHotels = await res.json();

            countBadge.textContent = `${allHotels.length} Hotels`;
            renderHotels(allHotels);
            loadRevenue();

        } catch(error) {
            console.error("Failed to load hotels:", error);
            container.innerHTML = `<p class="initial-message" style="color: var(--color-danger);">
                <i class="fas fa-times-circle"></i> Failed to load hotels. Ensure backend is running on ${API_URL}.
            </p>`;
            showToast("Failed to load hotels. Server connection error.", 'error');
        }
    }

    // Load and display revenue data (Existing)
    async function loadRevenue() {
        const container = document.getElementById("revenueContainer");
        container.innerHTML = '<p class="initial-message"><i class="fas fa-spinner fa-spin"></i> Calculating revenue...</p>';

        try {
            const res = await fetch(`${API_URL}/reservations/revenue`);

            if (!res.ok) {
                if (res.status === 403 || res.status === 401) {
                    throw new Error("Access Denied. You must be logged in as ADMIN to view revenue.");
                }
                throw new Error(`HTTP error! status: ${res.status}`);
            }

            const revenueMap = await res.json();

            if (Object.keys(revenueMap).length === 0) {
                container.innerHTML = `<p class="initial-message">No room reservations found yet.</p>`;
                return;
            }

            let tableHtml = `<table class="revenue-table"><thead><tr>
                <th><i class="fas fa-building"></i> Hotel Name</th>
                <th><i class="fas fa-sack-dollar"></i> Total Revenue</th>
            </tr></thead><tbody>`;

            let grandTotal = 0;

            for (const [hotelName, revenue] of Object.entries(revenueMap)) {
                tableHtml += `
                    <tr>
                        <td>${hotelName}</td>
                        <td>${formatCurrency(revenue)}</td>
                    </tr>
                `;
                grandTotal += revenue;
            }

            tableHtml += `
                <tr>
                    <td style="font-weight: bold; background: #e6f7ff; color: var(--color-dark);">GRAND TOTAL</td>
                    <td style="font-weight: bold; background: #e6f7ff; color: var(--color-success); font-size: 1.2em;">${formatCurrency(grandTotal)}</td>
                </tr>
            `;

            tableHtml += `</tbody></table>`;
            container.innerHTML = tableHtml;

        } catch(error) {
            console.error("Failed to load revenue data:", error);
            container.innerHTML = `<p class="initial-message" style="color: var(--color-danger);">
                <i class="fas fa-times-circle"></i> Failed to load revenue. ${error.message.includes('Access Denied') ? error.message : 'Server connection error.'}
            </p>`;
        }
    }


    function renderHotels(hotelsToRender) {
        const container = document.getElementById("hotelsContainer");
        container.innerHTML = "";

        if (hotelsToRender.length === 0) {
            container.innerHTML = "<p class='initial-message'>No hotels match your search criteria.</p>";
            return;
        }

        hotelsToRender.forEach(h => {
            const images = h.images || [];
            const hasMultipleHotelImages = images.length > 1;
            const roomCount = h.rooms ? h.rooms.length : 0;

            const sliderDotsHtml = images.length > 0 ? `<div class="slider-dots">
                ${images.map((_, index) => `<span class="dot ${index === 0 ? 'active' : ''}"></span>`).join('')}
            </div>` : '';


            const div = document.createElement("div");
            div.className = "hotel-card";
            div.innerHTML = `
                <h3>${h.name} <span style="font-size:0.6em; color:#999; font-weight: 400;">(ID: ${h.id})</span></h3>

                <div class="image-slider-container" id="hotel-slider-${h.id}">
                    ${images.length > 0 ? images.map((img, index) => `
                        <img src="${img.imageUrl}"
                             class="slider-image ${index === 0 ? 'active' : ''}"
                             alt="${h.name} image ${index + 1}"
                             onerror="this.onerror=null;this.src='https://via.placeholder.com/400x200?text=Image+Error'">
                    `).join('') : `<img src="https://via.placeholder.com/400x200?text=No+Image+Available" class="slider-image active" alt="No Image">`}

                    ${sliderDotsHtml}

                    ${hasMultipleHotelImages ? `
                    <button class="slider-btn prev-btn" onclick="slideImage(${h.id}, -1, 'hotel', event)">&#10094;</button>
                    <button class="slider-btn next-btn" onclick="slideImage(${h.id}, 1, 'hotel', event)">&#10095;</button>
                    ` : ''}
                </div>

                <p><strong class="info-icon"><i class="fas fa-map-marker-alt"></i></strong> <strong>Location:</strong> ${h.location}</p>
                <p><strong class="info-icon"><i class="fas fa-file-alt"></i></strong> <strong>Description:</strong> ${h.description || 'No description provided'}</p>

                <div class="card-actions">
                    <button class="action-btn edit-btn" onclick="openModalForEdit(${h.id}, 'hotel')"><i class="fas fa-pen"></i> Edit</button>
                    <button class="action-btn delete-btn" onclick="deleteHotel(${h.id})"><i class="fas fa-trash-alt"></i> Delete</button>

                    <div class="manage-btn-container">
                        <a href="manage-rooms.html?hotelId=${h.id}" class="action-btn manage-btn">
                            <i class="fas fa-door-open"></i> Manage Rooms (${roomCount})
                        </a>
                    </div>
                </div>
            `;
            container.appendChild(div);
        });
    }


    async function deleteHotel(id) {
        if (!confirm("‚ö†Ô∏è Are you sure you want to delete this hotel and ALL its rooms? This action cannot be undone.")) return;

        try {
            const res = await fetch(`${API_URL}/hotels/${id}`, { method: "DELETE" });
            if (res.ok) {
                showToast("Hotel deleted successfully!", 'success');
            } else {
                showToast(`Failed to delete hotel. Status: ${res.status}`, 'error');
            }
        } catch(error) {
            showToast(`Error deleting hotel: ${error.message}`, 'error');
        }

        loadHotels();
    }


    // --- Event Listeners and Modal Logic ---

    document.getElementById("hotelForm").addEventListener("submit", async e => {
        e.preventDefault();
        setLoading('submitHotelBtn', true);

        const hotelImagesText = document.getElementById("hotelImages").value;
        const hotel = {
            name: hotelName.value,
            location: hotelLocation.value,
            description: hotelDescription.value,
            images: urlsToImages(hotelImagesText)
        };

        try {
            const res = await fetch(`${API_URL}/hotels`, {
                method:"POST",
                headers:{ "Content-Type":"application/json" },
                body:JSON.stringify(hotel)
            });

            if (res.ok) {
                showToast("Hotel added successfully!", 'success');
                e.target.reset();
            } else {
                showToast(`Failed to add hotel. Status: ${res.status}`, 'error');
            }
        } catch(error) {
            showToast(`Error adding hotel: ${error.message}`, 'error');
        } finally {
            setLoading('submitHotelBtn', false);
        }
        loadHotels();
    });

    document.getElementById('hotelSearch').addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();
        const filteredHotels = allHotels.filter(h =>
            h.name.toLowerCase().includes(query) ||
            h.location.toLowerCase().includes(query)
        );
        renderHotels(filteredHotels);
    });

    // Modal and Slider functions (Existing)

    function closeModal() {
        document.getElementById('editModal').style.display = 'none';
        document.getElementById('editForm').reset();
    }

    function openModalForEdit(id, type) {
        let item = findItem(id, type);
        if (!item) { showToast("Error: Item not found.", 'error'); return; }

        document.getElementById('modalTitle').innerHTML = `<i class="fas fa-pen"></i> Edit ${type.charAt(0).toUpperCase() + type.slice(1)}`;
        document.getElementById('editItemId').value = item.id;
        document.getElementById('editItemType').value = type;
        document.getElementById('editImages').value = item.images ? item.images.map(i => i.imageUrl).join('\n') : '';

        const roomFields = document.getElementById('roomSpecificFields');
        const locationLabel = document.getElementById('locationLabel');
        const editLocationInput = document.getElementById('editLocation');
        const descriptionLabel = document.getElementById('descriptionLabel');
        const editNameLabel = document.getElementById('nameLabel');

        if (type === 'hotel') {
            document.getElementById('editName').value = item.name;
            editLocationInput.value = item.location;
            document.getElementById('editDescription').value = item.description;

            locationLabel.style.display = 'block';
            editLocationInput.style.display = 'block';
            editNameLabel.innerText = 'Name';
            descriptionLabel.innerText = 'Description';
            roomFields.style.display = 'none';
        } else {
            document.getElementById('editName').value = item.roomNumber;
            document.getElementById('editDescription').value = item.type;
            document.getElementById('editPrice').value = item.price;
            document.getElementById('editAvailable').value = String(item.available);

            locationLabel.style.display = 'none';
            editLocationInput.style.display = 'none';
            editNameLabel.innerText = 'Room Number';
            descriptionLabel.innerText = 'Type';
            roomFields.style.display = 'block';
        }

        document.getElementById('editModal').style.display = 'block';
    }

    document.getElementById('editForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        setLoading('editForm button[type="submit"]', true);

        const id = document.getElementById('editItemId').value;
        const type = document.getElementById('editItemType').value;
        const newImgText = document.getElementById('editImages').value;
        const imagesArray = urlsToImages(newImgText);

        let updatedData = { images: imagesArray };
        let url = type === 'hotel' ? `${API_URL}/hotels/${id}` : `${API_URL}/rooms/${id}`;

        if (type === 'hotel') {
            updatedData.name = document.getElementById('editName').value;
            updatedData.location = document.getElementById('editLocation').value;
            updatedData.description = document.getElementById('editDescription').value;
        } else if (type === 'room') {
            updatedData.roomNumber = document.getElementById('editName').value;
            updatedData.type = document.getElementById('editDescription').value;
            updatedData.price = parseFloat(document.getElementById('editPrice').value);
            updatedData.available = document.getElementById('editAvailable').value === 'true';
        }

        try {
            const res = await fetch(url, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updatedData)
            });

            if (res.ok) {
                showToast(`${type.charAt(0).toUpperCase() + type.slice(1)} updated successfully!`, 'success');
            } else {
                showToast(`Failed to update ${type}. Status: ${res.status}`, 'error');
            }
        } catch(error) {
            showToast(`Error updating ${type}: ${error.message}`, 'error');
        } finally {
            setLoading('editForm button[type="submit"]', false);
        }

        closeModal();
        loadHotels();
    });

    function updateSliderDots(sliderContainer, newIndex) {
        const dotsContainer = sliderContainer.querySelector('.slider-dots');
        if (!dotsContainer) return;

        const dots = dotsContainer.querySelectorAll('.dot');
        dots.forEach(dot => dot.classList.remove('active'));
        if (dots[newIndex]) {
            dots[newIndex].classList.add('active');
        }
    }

    function slideImage(id, direction, type, event) {
        if (event) event.stopPropagation();

        const selectorId = type === 'hotel' ? `hotel-slider-${id}` : `room-slider-${id}`;
        const sliderContainer = document.getElementById(selectorId);
        if (!sliderContainer) return;

        const images = sliderContainer.querySelectorAll('.slider-image');
        if (images.length < 2) return;

        let currentIndex = -1;
        images.forEach((img, index) => {
            if (img.classList.contains('active')) {
                currentIndex = index;
                img.classList.remove('active');
            }
        });

        let newIndex = currentIndex + direction;
        if (newIndex >= images.length) {
            newIndex = 0;
        } else if (newIndex < 0) {
            newIndex = images.length - 1;
        }

        images[newIndex].classList.add('active');
        updateSliderDots(sliderContainer, newIndex);
    }

    // --- Initialization ---
    window.openModalForEdit = openModalForEdit;
    window.deleteHotel = deleteHotel;
    window.logout = logout;
    window.slideImage = slideImage;
    window.closeModal = closeModal;
    loadHotels(); // Start the process
</script>
</body>
</html>